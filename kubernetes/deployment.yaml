apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: frontend
  template:
    metadata:
      labels:
        app: frontend
    spec:
      containers:
      - name: frontend
        image: ghcr.io/uengine-oss/process-gpt:latest
        ports:
        - containerPort: 8080
        env:
        - name: VITE_OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: openai-secret
              key: OPENAI_API_KEY
        - name: VITE_SUPABASE_URL
          valueFrom:
            configMapKeyRef:
              name: my-config
              key: SUPABASE_URL
        - name: VITE_SUPABASE_KEY
          valueFrom:
            secretKeyRef:
              name: my-secrets
              key: SERVICE_ROLE_KEY
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: execution-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: execution
  template:
    metadata:
      labels:
        app: execution
    spec:
      containers:
      - name: execution
        image: ghcr.io/uengine-oss/process-gpt-execution:latest
        ports:
        - containerPort: 8000
        env:
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: openai-secret
              key: OPENAI_API_KEY
        - name: SUPABASE_URL
          valueFrom:
            configMapKeyRef:
              name: my-config
              key: SUPABASE_URL
        - name: SUPABASE_KEY
          valueFrom:
            secretKeyRef:
              name: my-secrets
              key: SERVICE_ROLE_KEY
        - name: SUPABASE_JWT_SECRET
          valueFrom:
            secretKeyRef:
              name: my-secrets
              key: JWT_SECRET
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: autonomous-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app: autonomous
  template:
    metadata:
      labels:
        app: autonomous
    spec:
      containers:
      - name: autonomous
        image: ghcr.io/uengine-oss/process-gpt-autonomous:latest
        ports:
        - containerPort: 6789
        env:
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: openai-secret
              key: OPENAI_API_KEY
        # - name: SERPER_API_KEY
        #   valueFrom:
        #     secretKeyRef:
        #       name: serper-api-key-secret
        #       key: SERPER_API_KEY
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: memento-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: memento
  template:
    metadata:
      labels:
        app: memento
    spec:
      containers:
      - name: memento
        image: ghcr.io/uengine-oss/process-gpt-memento:latest
        ports:
        - containerPort: 8005
        env:
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: openai-secret
              key: OPENAI_API_KEY